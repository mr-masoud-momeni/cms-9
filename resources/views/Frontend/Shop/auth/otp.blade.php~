@extends('Frontend.Shop.layouts.Master')
@section('Main')
    <div class="content container min-vh-100 d-flex justify-content-center align-items-center">
        <div class="row w-100">
            <div class="col-md-6 mx-auto text-center">
                <h2>کد تأیید ارسال‌شده به {{ $phone }}</h2>

                <form method="POST" action="{{ route('buyer.otp.verify') }}">
                    @csrf
                    <input type="hidden" name="phone" value="{{ $phone }}">
                    <input type="hidden" name="purpose" value="{{ $purpose }}">

                    <input name="code" class="form-control mb-3" placeholder="کد تایید">
                    <button class="btn btn-primary w-100">تایید</button>
                </form>

                {{-- شمارنده --}}
                @if(session('otp_expires_at'))
                    <p class="mt-3" id="countdown"
                       data-seconds="{{ max(0, session('otp_expires_at')->diffInSeconds(now())) }}">
                        ارسال مجدد تا
                        <span id="seconds"></span>
                        ثانیه دیگر
                    </p>
                @endif

                {{-- فرم ارسال مجدد --}}
                <form method="POST"
                      action="{{ route('buyer.otp.resend') }}"
                      id="resend-form"
                      class="mt-3 d-none">
                    @csrf
                    <input type="hidden" name="phone" value="{{ $phone }}">
                    <input type="hidden" name="purpose" value="{{ $purpose }}">

                    <button class="btn btn-outline-secondary w-100">
                        ارسال مجدد کد
                    </button>
                </form>
            </div>
        </div>
    </div>
@endsection
@section('scripts')
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const countdownEl = document.getElementById('countdown');
            if (!countdownEl) return;

            const secondsEl = document.getElementById('seconds');
            const resendForm = document.getElementById('resend-form');

            let seconds = parseInt(countdownEl.dataset.seconds, 10);
            secondsEl.textContent = seconds;

            const timer = setInterval(() => {
                seconds--;
                secondsEl.textContent = seconds;

                if (seconds <= 0) {
                    clearInterval(timer);
                    countdownEl.classList.add('d-none');
                    resendForm.classList.remove('d-none');
                }
            }, 1000);
        });
    </script>
@endsection
